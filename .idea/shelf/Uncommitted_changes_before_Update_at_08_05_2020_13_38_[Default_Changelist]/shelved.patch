Index: src/Controller/BlogController.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\r\n\r\nnamespace App\\Controller;\r\n\r\nuse App\\Entity\\Blog;\r\nuse App\\Form\\BlogType;\r\nuse App\\Repository\\BlogRepository;\r\nuse App\\Repository\\CategoryRepository;\r\nuse App\\Repository\\TagRepository;\r\nuse App\\Services\\FileService;\r\nuse DateTime;\r\nuse Symfony\\Bundle\\FrameworkBundle\\Controller\\AbstractController;\r\nuse Symfony\\Component\\HttpFoundation\\Request;\r\nuse Symfony\\Component\\HttpFoundation\\Response;\r\nuse Symfony\\Component\\Routing\\Annotation\\Route;\r\n\r\nclass BlogController extends AbstractController\r\n{\r\n    /**\r\n     * @Route(\"/blog\", name=\"blog_show_list\", methods={\"GET\"})\r\n     * @param BlogRepository $blogRepository\r\n     * @param CategoryRepository $categoryRepository\r\n     * @return Response\r\n     */\r\n    public function list(BlogRepository $blogRepository, CategoryRepository $categoryRepository): Response\r\n    {\r\n        return $this->render('blog/list.html.twig', [\r\n            'posts' => $blogRepository->findAll(),\r\n            'categories' => $categoryRepository->findBy(['environnement' => '2'])\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     * C'est la sidebar de la page list et de la page simple\r\n     * @param BlogRepository $blogRepository\r\n     * @param CategoryRepository $categoryRepository\r\n     * @param TagRepository $tagRepository\r\n     * @return Response\r\n     */\r\n    public function blogSideBar(BlogRepository $blogRepository, CategoryRepository $categoryRepository, TagRepository $tagRepository)\r\n    {\r\n        return $this->render('blog/blog_side_bar.html.twig', [\r\n            'posts' => $blogRepository->findAllOrderByView(),\r\n            'categories' => $categoryRepository->findAllCategoriesBlog(),\r\n            'tags' => $tagRepository->findAllBlogsTags()\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     * @Route(\"/blog/{slug}\", name=\"blog_show_detail\", methods={\"GET\"})\r\n     * @param Blog $blog\r\n     * @return Response\r\n     */\r\n    public function show(Blog $blog): Response\r\n    {\r\n        if ($blog) {\r\n            $blog->setView($blog->getView() + 1);\r\n            $entityManager = $this->getDoctrine()->getManager();\r\n            $entityManager->persist($blog);\r\n            $entityManager->flush();\r\n        }\r\n        return $this->render('blog/detail.html.twig', [\r\n            'blog' => $blog,\r\n        ]);\r\n    }\r\n    /**\r\n     * @Route(\"/admin/blog\", name=\"blog_index\", methods={\"GET\"})\r\n     * @param BlogRepository $blogRepository\r\n     * @return Response\r\n     */\r\n    public function index(BlogRepository $blogRepository): Response\r\n    {\r\n        return $this->render('blog/index.html.twig', [\r\n            'blogs' => $blogRepository->findAll(),\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     * @Route(\"/admin/blog/new\", name=\"blog_new\", methods={\"GET\",\"POST\"})\r\n     * @param Request $request\r\n     * @param FileService $fileService\r\n     * @return Response\r\n     */\r\n    public function new(Request $request, FileService $fileService): Response\r\n    {\r\n        $blog = new Blog();\r\n        $form = $this->createForm(BlogType::class, $blog);\r\n        $form->handleRequest($request);\r\n\r\n        if ($form->isSubmitted() && $form->isValid()) {\r\n            $documentsCollection = [$form->getData()->getMainImage()[0]];\r\n            // Fais pas attention a ce foreach\r\n            foreach ($documentsCollection as $key => $result){\r\n                if ($result) {\r\n                    $data = $fileService->transformToWebP($result->getFile());\r\n                    $result->setCompleteUrl($data['filename']);\r\n                    $result->setFolder($data['folder']);\r\n                    $result->setBlog($blog);\r\n                    $result->setUpdatedAt(new DateTime('now'));\r\n                    $blog->addMainImage($result);\r\n                    $fileService->moveToFolderAndModifyToWebP($this->getParameter($data['folder']), $data['ext'], $data['filename']);\r\n                }\r\n            }\r\n            $blog->setUser($this->getUser());\r\n            $blog->setSlug($blog->getTitle());\r\n            $blog->setCreatedAt(new DateTime('now'));\r\n            $blog->setUpdatedAt(new DateTime('now'));\r\n            $entityManager = $this->getDoctrine()->getManager();\r\n            $entityManager->persist($blog);\r\n            $entityManager->flush();\r\n\r\n            return $this->redirectToRoute('blog_index');\r\n        }\r\n\r\n        return $this->render('blog/new.html.twig', [\r\n            'blog' => $blog,\r\n            'form' => $form->createView(),\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     * @Route(\"/admin/blog/edit/{slug}\", name=\"blog_edit\", methods={\"GET\",\"POST\"})\r\n     * @param Request $request\r\n     * @param Blog $blog\r\n     * @param FileService $fileService\r\n     * @return Response\r\n     */\r\n    public function edit(Request $request, Blog $blog, FileService $fileService): Response\r\n    {\r\n        $form = $this->createForm(BlogType::class, $blog);\r\n        $form->handleRequest($request);\r\n\r\n        if ($form->isSubmitted() && $form->isValid()) {\r\n            $documentsCollection = [$form->getData()->getMainImage()];\r\n            foreach ($documentsCollection as $document) {\r\n                foreach ($document as $image) {\r\n                    if ($image && $image->getFile()) {\r\n                        $dataEdit = $fileService->transformToWebP($image->getFile());\r\n                        $image->setCompleteUrl($dataEdit['filename']);\r\n                        $image->setBlog($blog);\r\n                        $image->setFolder('images');\r\n                        $blog->addMainImage($image);\r\n                        if ($image->getTempFileName()) {\r\n                            $fileService->uploadFolder($this->getParameter($dataEdit['folder']), $dataEdit['ext'], $dataEdit['filename'], $image->getTempFileName().'.webp');\r\n                        } else {\r\n                            $image->setUpdatedAt(new DateTime('now'));\r\n                            $fileService->moveToFolderAndModifyToWebP($this->getParameter($dataEdit['folder']), $dataEdit['ext'], $dataEdit['filename']);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            $blog->setUpdatedAt(new DateTime('now'));\r\n            $this->getDoctrine()->getManager()->flush();\r\n\r\n            return $this->redirectToRoute('blog_index');\r\n        }\r\n\r\n        return $this->render('blog/edit.html.twig', [\r\n            'blog' => $blog,\r\n            'form' => $form->createView(),\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     * @Route(\"/admin/blog/{id}\", name=\"blog_delete\", methods={\"DELETE\"})\r\n     * @param Request $request\r\n     * @param Blog $blog\r\n     * @return Response\r\n     */\r\n    public function delete(Request $request, Blog $blog): Response\r\n    {\r\n        if ($this->isCsrfTokenValid('delete'.$blog->getId(), $request->request->get('_token'))) {\r\n            $image = $this->getParameter($blog->getMainImage()[0]->getFolder()).'/'.$blog->getMainImage()[0]->getCompleteUrl();\r\n            if (file_exists($image.'.webp')) {\r\n                unlink($image.'.webp');\r\n            }\r\n            $entityManager = $this->getDoctrine()->getManager();\r\n            $entityManager->remove($blog);\r\n            $entityManager->flush();\r\n        }\r\n\r\n        return $this->redirectToRoute('blog_index');\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/Controller/BlogController.php	(revision e53a10ec1846564eeb419abb1ca1411064a0a313)
+++ src/Controller/BlogController.php	(date 1588937898870)
@@ -24,6 +24,7 @@
      */
     public function list(BlogRepository $blogRepository, CategoryRepository $categoryRepository): Response
     {
+        dd($blogRepository->findAllPaginated($page));
         return $this->render('blog/list.html.twig', [
             'posts' => $blogRepository->findAll(),
             'categories' => $categoryRepository->findBy(['environnement' => '2'])
